<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$DIELON Fantasy</title>
  <script type="module">
    import { createWalletClient, custom } from 'https://cdn.jsdelivr.net/npm/viem@2.7.0/+esm'
    import { base } from 'https://cdn.jsdelivr.net/npm/viem/chains@2.7.0/+esm'

    const contractAddress = "0x4b11ddaadc173d24ce8d35af11341fb83762bb0ed90f9a4979c8145573369e2e"
    const ABI = [
      "function contests(uint256) view returns (string name, uint256 entryFee, uint256 salaryCap, uint256 maxEntries, uint256 totalEntries, uint256 prizePool, uint256 contestEndTime, bool settled, address[])",
      "function createContest(string name, uint256 entryFee, uint256 salaryCap, uint256 maxEntries, uint256 contestEndTime)",
      "function enterContest(uint256 contestId, uint256[] playerIds, uint256 totalSalary)"
    ]

    let client, account

    window.connect = async () => {
      if (!window.ethereum) return alert("Install MetaMask!")
      client = createWalletClient({ chain: base, transport: custom(window.ethereum) })
      const [addr] = await client.requestAddresses()
      account = addr
      document.getElementById("status").textContent = "Connected: " + addr.slice(0,10) + "... on Base"
    }

    window.create = async () => {
      if (!account) return alert("Connect wallet first!")
      const name = prompt("Contest name", "NFL Week 12") || "Contest"
      const fee = prompt("Entry fee in $DIELON", "100")
      const cap = prompt("Salary cap", "50000")
      const max = prompt("Max players", "50")
      const hours = prompt("Hours until end", "48")
      const end = Math.floor(Date.now()/1000) + (Number(hours) * 3600)

      await client.writeContract({
        address: contractAddress,
        abi: ABI,
        functionName: 'createContest',
        args: [name, BigInt(fee)*10n**18n, Number(cap), Number(max), end],
        account
      })
      alert("Contest created!")
    }
  </script>
  <style>
    body{background:#0f0f1a;color:#fff;font-family:Arial;text-align:center;padding:40px}
    h1{color:#00ff9d}
    button{background:#00ff9d;color:#000;padding:15px 30px;border:none;border-radius:10px;font-size:18px;margin:10px;cursor:pointer}
    #status{color:#00ff9d;margin:20px;font-weight:bold}
  </style>
</head>
<body>
  <h1>$DIELON Fantasy</h1>
  <button onclick="connect()">Connect Wallet</button>
  <button onclick="create()">Create Contest</button>
  <p id="status"></p>
</body>
</html>
