<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$DIELON Fantasy</title>
  <style>
    body{background:#0f0f1a;color:#fff;font-family:Arial;text-align:center;padding:40px}
    h1{color:#00ff9d}
    button{background:#00ff9d;color:#000;padding:15px 30px;border:none;border-radius:10px;font-size:18px;margin:10px;cursor:pointer}
    #status{color:#00ff9d;margin:20px;font-weight:bold}
    #error{color:#ff0066;margin:20px;font-weight:bold}
  </style>
</head>
<body>
  <h1>$DIELON Fantasy</h1>
  <button onclick="connect()">Connect Wallet</button>
  <button onclick="create()">Create Contest</button>
  <p id="status"></p>
  <p id="error"></p>

  <script>
    const contractAddress = "0x5E9563957A2E317BD07204f1C62EE9F81d83a0c6"; // â† CORRECT ADDRESS
    const BASE_CHAIN_ID = "0x2105";

    let account;

    async function connect() {
      document.getElementById("error").textContent = "";
      document.getElementById("status").textContent = "Connecting...";

      if (!window.ethereum) return document.getElementById("error").textContent = "Install MetaMask/Coinbase Wallet!";

      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        account = accounts[0];

        try {
          await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: BASE_CHAIN_ID }] });
        } catch (e) {
          if (e.code === 4902) {
            await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [{
              chainId: BASE_CHAIN_ID,
              chainName: 'Base',
              rpcUrls: ['https://mainnet.base.org'],
              nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
              blockExplorerUrls: ['https://basescan.org']
            }] });
          }
        }

        document.getElementById("status").textContent = "Connected: " + account.slice(0,10) + "... on Base!";
      } catch (err) {
        document.getElementById("error").textContent = "Error: " + err.message;
      }
    }

    async function create() {
      if (!account) return document.getElementById("error").textContent = "Connect wallet first!";
      const name = prompt("Contest name", "NFL Week 12") || "Contest";
      if (!name) return;
      const fee = prompt("Entry fee in $DIELON", "100") || "100";
      const cap = prompt("Salary cap", "50000") || "50000";
      const max = prompt("Max players", "50") || "50";
      const hours = prompt("Hours until end", "48") || "48";
      const end = Math.floor(Date.now()/1000) + (Number(hours) * 3600);

      try {
        document.getElementById("status").textContent = "Approve in wallet...";
        const tx = await window.ethereum.request({
          method: 'eth_sendTransaction',
          params: [{
            from: account,
            to: contractAddress,
            data: `0x9b5f2b6e${ // createContest selector
              "0".padEnd(64, "0")}${ // offset for string
              (BigInt(fee)*10n**18n).toString(16).padStart(64,"0")}${ // fee
              Number(cap).toString(16).padStart(64,"0")}${ // cap
              Number(max).toString(16).padStart(64,"0")}${ // max
              end.toString(16).padStart(64,"0")}${ // end
              (name.length*2).toString(16).padStart(64,"0")}${ // string length
              name.split('').map(c=>c.charCodeAt(0).toString(16).padStart(2,"0")).join("").padEnd(64,"0")
            }`
          }]
        });
        document.getElementById("status").textContent = "Contest created! Tx: " + tx;
      } catch (err) {
        document.getElementById("error").textContent = "Error: " + err.message;
      }
    }
  </script>
</body>
</html>
